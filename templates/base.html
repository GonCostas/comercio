{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Enigma{% endblock %}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/ordenes.css' %}">
    <link rel="icon" href="{% static 'img/enigma.ico' %}" type="image/x-icon">
</head>
<body class="d-flex flex-column min-vh-100">

    <!-- HEADER FIJO -->
    {% include 'includes/header.html' %}

    <!-- CONTENIDO CENTRAL -->
    <div class="d-flex flex-grow-1">
        <!-- SIDEBAR si corresponde -->
        {% if user.is_authenticated %}
            {% include 'includes/navbar.html' %}
        {% endif %}
        <!-- MAIN con scroll si hay mucho contenido -->
        <main class="flex-grow-1 p-3 overflow-auto">
            {% if user.is_authenticated %}
                <button class="btn btn-outline-primary mb-1" onclick="toggleSidebar()">☰</button>
            {% endif %}

            {% block content %}

            <!-- El contenido se mostrará aquí. Puedes personalizarlo según tus necesidades. -->

            {% endblock %}
        </main>
    </div>

    <!-- FOOTER FIJO AL FINAL -->
    <!-- { % include 'includes/footer.html' % } -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{% static 'js/script.js' %}"></script>
    <!-- Bootstrap 5 JS (required for collapse) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'js/ordenes.js' %}"></script>
    <script src="{% static 'js/remitos.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
        let openMenus = [];

        try {
            const storedMenus = localStorage.getItem('openSubmenus');
            if (storedMenus) {
            openMenus = JSON.parse(storedMenus);
            }
        } catch (e) {
            console.warn('Error leyendo openSubmenus de localStorage:', e);
            localStorage.removeItem('openSubmenus');  // Lo limpio para evitar futuros errores
        }

        // Restaurar submenús abiertos
        openMenus.forEach(menuId => {
            const submenu = document.getElementById(menuId);
            if (submenu) {
            submenu.classList.add('show');
            const trigger = document.querySelector(`[href="#${menuId}"]`);
            if (trigger) {
                trigger.setAttribute('aria-expanded', 'true');
            }
            }
        });

        // Escuchar clics para guardar el estado
        document.querySelectorAll('[data-bs-toggle="collapse"]').forEach(toggle => {
            toggle.addEventListener('click', function () {
            const menuId = this.getAttribute('href').replace('#', '');
            const index = openMenus.indexOf(menuId);

            if (index > -1) {
                openMenus.splice(index, 1); // Cerrar
            } else {
                openMenus.push(menuId); // Abrir
            }

            localStorage.setItem('openSubmenus', JSON.stringify(openMenus));
            });
        });
        });

    </script>
</body>
</html>
